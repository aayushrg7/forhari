#if 0
	shc Version 4.0.3, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f cxfs.sh -o cxfs 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[2]))
	"\246\300\352\074\305\124\022\236\025\363\042\225\020\206\042\242"
	"\347\143\377\356\312\004\342\302\111"
#define      opts_z	1
#define      opts	((&data[25]))
	"\314"
#define      msg2_z	19
#define      msg2	((&data[27]))
	"\164\255\310\365\001\154\035\064\315\140\027\250\253\261\237\265"
	"\340\343\127\161\053\353\116"
#define      msg1_z	65
#define      msg1	((&data[50]))
	"\003\010\066\123\314\370\130\054\020\326\223\252\242\042\205\072"
	"\320\212\237\240\070\122\324\153\267\342\070\333\073\132\206\336"
	"\156\356\116\022\366\301\116\317\064\217\173\236\122\277\246\212"
	"\262\323\212\061\345\236\316\061\247\270\271\116\044\060\265\033"
	"\146\070\165\020\177\346\246\315\126\321\312\331\264"
#define      lsto_z	1
#define      lsto	((&data[126]))
	"\246"
#define      inlo_z	3
#define      inlo	((&data[127]))
	"\241\234\062"
#define      date_z	1
#define      date	((&data[130]))
	"\322"
#define      rlax_z	1
#define      rlax	((&data[131]))
	"\011"
#define      shll_z	10
#define      shll	((&data[133]))
	"\172\345\063\223\210\215\067\352\355\044\117\154\307"
#define      xecc_z	15
#define      xecc	((&data[146]))
	"\076\014\165\040\037\202\037\034\257\360\320\200\337\062\073\247"
#define      pswd_z	256
#define      pswd	((&data[170]))
	"\274\172\267\206\123\153\367\355\044\357\315\363\350\227\140\227"
	"\347\132\225\331\304\204\253\150\010\223\002\324\111\233\015\064"
	"\270\000\065\130\260\144\142\017\123\057\003\074\306\144\323\256"
	"\276\150\207\203\355\063\354\365\307\356\312\020\212\327\104\102"
	"\327\172\233\207\336\375\227\062\055\232\157\364\377\102\242\275"
	"\253\051\101\230\135\055\215\044\034\127\064\246\057\171\351\006"
	"\363\205\216\322\203\046\005\260\301\164\244\300\267\107\176\142"
	"\161\277\372\316\355\207\363\011\337\047\260\016\241\232\025\225"
	"\037\244\150\242\312\156\123\213\343\370\114\232\077\312\374\260"
	"\212\366\177\167\176\162\200\136\231\061\155\073\313\202\321\352"
	"\047\071\215\362\247\340\176\213\330\312\045\027\224\041\310\036"
	"\030\107\226\227\271\026\365\123\107\142\216\023\345\137\375\014"
	"\231\212\377\101\152\175\314\103\107\361\132\334\023\042\373\054"
	"\152\221\303\043\250\271\166\360\033\005\003\000\145\001\015\376"
	"\213\014\100\366\212\014\071\321\376\224\256\022\267\252\076\041"
	"\073\001\104\344\273\273\325\326\300\330\327\045\331\345\044\145"
	"\362\144\134\174\161\226\116\160\053\112\112\046\145\045\055\034"
	"\124\371\107\257\261\301\033\170\360\212\265\057\171\331\024\066"
	"\123\314\275\247\070\265\225\134\377\340\203\145\005\261\201\131"
	"\252\311\011\134\213\044\325\173\257\212\252\051\144\277\137\267"
	"\213\035\137"
#define      text_z	2408
#define      text	((&data[978]))
	"\040\322\324\244\067\332\125\271\063\000\202\075\135\015\141\062"
	"\211\020\275\063\071\041\363\231\331\177\266\070\103\210\054\144"
	"\132\001\010\221\333\136\112\017\137\315\114\274\332\255\357\143"
	"\275\254\227\367\315\212\220\246\012\106\337\115\316\013\261\051"
	"\014\272\273\350\031\005\367\170\323\103\065\255\361\044\021\256"
	"\320\250\246\236\063\066\105\075\175\044\213\114\060\074\165\075"
	"\367\060\045\020\066\034\211\011\140\276\267\121\343\310\000\264"
	"\161\246\123\245\335\230\343\132\275\156\246\355\253\034\053\243"
	"\115\120\263\203\154\075\215\314\374\104\036\337\015\036\223\177"
	"\304\346\044\241\177\010\374\075\166\243\053\042\277\126\305\015"
	"\246\171\220\023\267\036\340\263\142\376\222\160\034\046\357\340"
	"\015\023\202\215\033\177\312\222\042\365\265\342\113\173\357\362"
	"\365\200\005\254\236\345\137\001\343\362\161\000\031\140\341\046"
	"\164\143\264\220\342\176\043\005\164\330\347\277\123\327\261\111"
	"\127\267\365\366\234\125\367\200\107\151\201\141\311\142\210\076"
	"\306\074\316\251\272\361\256\057\312\226\356\036\156\240\147\306"
	"\127\134\274\364\262\264\165\372\035\366\133\347\131\343\046\037"
	"\040\364\311\333\346\167\012\260\016\371\316\174\231\066\102\361"
	"\223\377\346\105\263\133\077\321\122\233\271\254\177\337\313\237"
	"\324\224\172\273\014\204\153\033\175\072\230\027\161\332\010\004"
	"\332\356\111\216\112\211\140\235\045\031\111\244\371\025\103\315"
	"\252\276\210\266\103\364\322\300\057\152\330\240\105\340\244\037"
	"\317\356\255\032\170\015\270\235\047\001\102\040\026\205\356\300"
	"\104\166\167\207\153\111\110\232\264\040\072\371\001\336\030\320"
	"\315\306\353\105\324\243\342\373\245\044\034\274\252\012\175\357"
	"\201\364\166\354\076\276\206\362\337\300\354\340\237\004\261\154"
	"\312\234\262\237\100\225\232\345\272\267\241\145\301\036\124\102"
	"\023\313\057\122\211\265\105\150\166\061\111\026\066\372\203\000"
	"\227\065\240\327\312\072\275\204\362\136\352\263\175\076\366\221"
	"\011\045\343\223\333\051\374\121\132\105\147\220\100\352\221\327"
	"\037\061\256\352\154\154\157\136\313\131\022\110\230\011\123\135"
	"\041\071\357\214\005\340\101\356\320\040\005\153\301\041\252\336"
	"\160\164\221\214\265\313\024\145\272\157\310\155\165\273\015\077"
	"\166\077\075\134\130\141\037\203\006\361\075\355\015\076\065\315"
	"\241\340\302\265\113\117\123\056\156\214\314\131\350\132\252\163"
	"\314\215\110\163\311\171\070\356\301\140\244\034\006\364\370\056"
	"\236\202\220\321\341\220\177\011\052\077\117\277\035\214\071\124"
	"\016\062\154\051\222\157\116\265\044\057\353\261\335\113\370\013"
	"\306\307\063\351\374\104\244\155\360\221\106\204\253\256\140\304"
	"\265\204\314\131\066\372\116\363\113\274\110\070\034\043\011\163"
	"\260\165\213\010\227\012\361\032\360\110\366\323\333\040\377\363"
	"\211\004\077\011\361\021\371\355\201\021\255\131\374\353\252\007"
	"\322\266\130\223\304\155\113\252\314\223\300\373\127\121\326\351"
	"\165\112\043\274\343\330\126\322\345\337\177\167\325\172\244\344"
	"\041\040\124\076\024\123\070\171\305\345\021\027\111\235\332\047"
	"\033\116\170\326\256\132\360\373\057\147\024\175\006\166\056\003"
	"\204\236\215\102\152\010\325\067\310\070\304\163\063\126\323\332"
	"\362\045\373\031\241\312\063\316\257\231\334\037\237\315\227\067"
	"\273\371\233\254\163\223\350\215\337\321\200\041\304\055\077\237"
	"\176\346\215\220\104\316\011\145\272\172\375\257\215\271\323\252"
	"\252\141\010\013\021\210\272\324\266\175\311\244\127\326\277\253"
	"\106\365\127\214\042\213\173\371\033\361\051\310\306\111\221\361"
	"\114\043\303\004\124\111\246\041\213\121\203\177\044\147\107\156"
	"\005\304\101\244\115\122\314\035\216\313\060\231\211\061\311\002"
	"\037\256\036\226\124\006\350\027\134\353\337\127\001\002\166\225"
	"\217\236\170\367\252\311\210\262\233\163\335\155\151\354\030\313"
	"\120\302\114\356\257\073\324\232\117\274\175\327\334\351\333\022"
	"\345\334\125\034\005\005\313\136\202\307\021\235\375\057\264\104"
	"\344\320\124\372\126\350\116\200\307\154\364\315\101\055\255\056"
	"\125\216\077\063\172\046\157\114\324\314\337\031\311\332\314\144"
	"\075\206\240\236\202\063\050\221\173\132\006\330\363\034\002\166"
	"\232\130\370\126\257\215\232\174\201\337\316\112\032\170\356\330"
	"\123\274\114\121\040\334\035\374\021\003\365\311\322\035\020\115"
	"\305\352\325\071\217\261\125\101\116\344\061\071\101\234\257\261"
	"\025\273\254\120\316\307\073\231\204\067\276\313\222\014\366\215"
	"\231\046\350\264\036\306\106\020\030\227\261\261\205\075\326\241"
	"\364\023\111\054\267\264\332\163\011\011\041\143\070\170\334\302"
	"\245\014\172\367\004\323\300\072\263\204\204\167\227\207\302\121"
	"\212\224\337\252\166\314\024\153\326\011\327\005\117\363\056\202"
	"\051\356\114\210\327\167\121\105\123\376\071\267\331\161\350\316"
	"\140\324\021\047\226\300\215\243\126\103\276\022\012\017\033\245"
	"\237\320\214\237\114\332\065\272\121\254\213\056\153\120\141\276"
	"\342\335\132\320\320\164\246\242\224\102\351\243\354\245\152\271"
	"\351\366\351\104\262\124\360\247\270\156\334\060\261\111\074\350"
	"\300\217\250\136\076\050\236\013\307\073\266\107\277\050\121\017"
	"\101\243\232\075\137\366\126\371\133\217\317\230\022\113\374\032"
	"\254\066\175\346\305\241\305\301\067\351\054\224\017\372\150\203"
	"\112\370\333\054\027\065\353\150\117\165\234\225\220\041\256\041"
	"\111\150\125\034\065\237\256\165\271\103\143\332\135\234\202\263"
	"\304\255\002\160\012\210\177\366\357\317\107\133\043\112\357\162"
	"\106\033\170\046\170\352\133\105\076\332\001\273\151\341\117\052"
	"\112\343\251\172\062\071\061\302\363\013\255\111\150\214\147\142"
	"\347\306\262\050\174\024\134\051\045\170\335\362\062\067\205\016"
	"\362\047\035\112\145\224\204\221\020\141\107\235\303\272\034\176"
	"\266\267\157\072\131\100\136\274\000\267\376\334\371\212\307\014"
	"\314\062\024\126\276\155\312\021\261\310\053\066\375\007\077\331"
	"\364\254\012\020\370\011\215\353\005\333\226\256\220\054\076\244"
	"\344\267\316\065\350\351\315\015\054\321\365\220\213\231\031\043"
	"\053\354\371\072\245\347\122\161\327\273\233\277\226\102\272\214"
	"\077\030\076\342\207\164\350\115\354\105\001\224\141\231\156\107"
	"\066\360\117\373\014\137\374\254\214\233\200\045\103\105\221\343"
	"\243\240\171\143\100\343\377\024\067\314\320\047\163\234\331\052"
	"\052\252\057\177\215\312\256\065\317\002\344\273\046\320\067\243"
	"\056\065\310\234\025\144\232\351\072\234\251\235\374\315\344\233"
	"\036\250\117\340\227\006\061\135\212\015\144\062\047\202\157\152"
	"\046\143\270\336\202\230\172\076\072\172\262\271\115\374\122\270"
	"\025\042\214\021\013\137\074\015\060\221\210\156\036\023\266\201"
	"\333\345\276\231\351\271\060\273\105\163\364\164\322\134\060\372"
	"\372\361\347\316\225\022\126\262\366\272\153\273\115\327\331\001"
	"\353\067\100\115\251\255\273\256\216\264\241\343\267\117\230\271"
	"\107\016\350\267\226\150\030\165\043\154\272\077\360\260\174\040"
	"\300\065\073\167\262\322\161\256\323\323\174\223\132\133\314\163"
	"\042\335\006\334\204\206\245\111\303\343\070\116\332\006\230\133"
	"\113\322\046\365\057\240\174\256\104\065\254\066\117\160\137\020"
	"\047\335\001\263\350\335\273\044\276\077\351\034\210\053\115\220"
	"\041\276\136\150\023\061\212\116\245\352\130\357\212\135\213\071"
	"\113\344\247\003\114\057\164\317\001\344\071\352\104\032\133\074"
	"\340\352\307\070\271\242\244\135\332\073\125\301\031\254\374\217"
	"\126\223\314\005\112\112\103\015\253\131\147\320\333\076\142\220"
	"\121\146\145\331\125\367\103\233\117\213\032\155\072\053\273\245"
	"\362\356\303\152\200\206\177\361\350\174\226\105\351\351\213\120"
	"\137\060\031\176\215\306\115\214\105\362\106\136\330\350\254\255"
	"\073\352\325\305\304\223\112\247\036\365\350\270\023\330\134\056"
	"\367\233\340\137\064\035\362\362\061\200\104\301\212\156\262\223"
	"\056\003\025\115\301\017\203\052\124\314\137\074\341\113\377\356"
	"\337\254\104\012\137\215\107\053\275\056\000\356\347\016\262\222"
	"\004\355\055\265\236\205\033\266\327\104\115\374\046\171\015\051"
	"\131\124\272\154\155\124\125\172\332\320\363\355\243\072\326\201"
	"\345\140\002\201\262\242\122\242\071\320\247\056\235\243\353\272"
	"\366\035\334\052\300\023\341\072\133\024\337\104\172\155\256\250"
	"\317\207\277\164\240\230\076\130\300\175\013\027\115\122\366\266"
	"\311\172\055\126\305\141\060\113\276\245\115\263\140\221\371\032"
	"\045\135\107\347\166\260\372\331\055\304\351\316\303\234\347\201"
	"\262\070\322\145\221\030\361\011\372\032\275\141\034\371\246\037"
	"\143\020\074\126\151\170\310\012\032\237\032\325\315\363\050\321"
	"\241\056\275\152\315\142\011\202\207\233\122\354\175\373\113\204"
	"\154\113\345\106\042\153\312\221\247\315\235\170\357\050\136\056"
	"\016\377\124\002\246\264\017\161\175\127\343\142\315\143\214\267"
	"\073\360\350\160\160\113\276\123\022\051\257\067\217\131\071\126"
	"\174\240\033\227\340\225\305\301\317\324\113\140\071\114\276\143"
	"\247\354\077\030\113\040\130\120\161\314\152\232\306\074\022\145"
	"\044\021\071\377\377\134\163\346\114\051\053\354\247\203\315\326"
	"\042\075\117\122\324\202\173\133\073\311\161\336\117\127\152\001"
	"\042\144\176\012\061\366\172\162\156\207\060\033\231\067\037\330"
	"\172\072\250\255\110\074\042\026\272\341\017\063\143\064\265\043"
	"\322\243\002\264\315\020\075\234\271\047\350\367\217\075\370\305"
	"\006\353\373\167\066\037\052\374\011\157\172\360\103\172\323\354"
	"\257\373\361\117\001\263\056\352\026\354\265\021\255\173\153\105"
	"\330\341\177\035\313\374\021\245\212\167\253\047\333\151\211\145"
	"\334\044\227\307\101\333\273\033\052\205\365\072\113\354\117\174"
	"\107\244\036\165\140\002\266\156\060\203\153\215\223\274\155\351"
	"\010\120\122\170\016\210\274\330\102\265\302\025\036\037\004\041"
	"\001\040\001\260\330\320\170\350\233\244\110\147\002\164\011\021"
	"\307\133\214\353\142\167\103\255\240\371\303\237\057\271\021\072"
	"\257\326\270\070\303\045\005\062\261\354\133\176\072\323\371\054"
	"\027\037\213\112\015\236\272\344\200\357\363\004\122\160\347\152"
	"\362\225\033\035\062\237\033\320\116\240\133\156\136\046\123\247"
	"\277\044\324\365\201\177\333\155\305\156\233\245\332\166\036\025"
	"\014\003\107\006\027\163\264\274\310\200\231\135\222\023\347\115"
	"\063\006\131\360\313\312\122\276\026\116\330\110\046\150\025\021"
	"\362\243\247\045\267\056\103\140\052\004\043\167\041\242\063\131"
	"\305\326\252\256\235\100\220\132\145\020\002\214\053\150\352\340"
	"\070\004\132\334\177\141\000\003\213\204\310\306\363\275\364\206"
	"\352\141\350\242\101\125\171\053\120\014\177\326\003\022\065\212"
	"\364\232\313\250\024\252\327\032\236\317\172\213\205\371\173\211"
	"\126\323\257\332\074\172\072\025\206\362\253\354\155\273\336\341"
	"\201\156\104\313\155\133\351\040\322\043\345\035\146\146\050\366"
	"\346\207\206\004\263\357\266\062\104\315\273\277\232\363\124\000"
	"\225\213\300\301\077\136\322\100\221\216\107\272\130\222\161\271"
	"\273\077\056\372\054\156\275\132\061\053\065\067\042\112\143\333"
	"\140\025\216\104\032\365\157\340\257\044\317\314\343\066\027\170"
	"\015\013\217\265\377\101\317\046\176\067\230\041\037\330\327\206"
	"\136\067\123\064\370\017\035\177\257\225\003\242\110\216\227\214"
	"\252\200\213\345\317\015\170\227\034\353\124\316\116\223\334\040"
	"\254\213\262\165\340\021\177\231\145\335\022\354\274\342\174\251"
	"\300\161\225\110\310\222\177\036\215\245\200\115\075\155\374\274"
	"\165\237\037\103\230\171\320\076\176\250\136\143\214\363\332\325"
	"\344\223\361\005\246\235\060\374\347\265\323\254\304\043\021\341"
	"\012\201\171\062\111\315\205\372\032\151\031\274\360\257\327\001"
	"\113\206\235\122\341\306\023\337\201\224\155\050\226\336\207\100"
	"\301\364\240\010\121\320\350\372\230\152\165\235\143\176\256\332"
	"\323\250\205\276\324\225\335\135\107\276\136\174\056\166\101\301"
	"\127\162\172\076\150\267\246\141\153\244\246\021\342\027\170\020"
	"\315\135\215\030\073\161\015\334\163\214\070\050\010\341\357\174"
	"\073\132\200\165\025\207\234\347\342\046\200\051\344\113\232\135"
	"\112\255\303\242\111\276\305\331\362\143\275\012\230\104\221\262"
	"\145\203\015\164\006\244\067\313\364\367\020\256\216\251\310\147"
	"\100\227\305\217\113\044\374\303\166\207\234\025\165\377\045\373"
	"\365\074\214\047\136\255\312\034\243\007\143\154\274\053\200\352"
	"\064\065\175\041\261\317\064\030\225\017\075\156\120\377\332\072"
	"\170\175\202\160\205\267\053\147\332\207\265\160\351\341\301\233"
	"\022\115\367\041\234\343\331\241\056\275\065\011\346\061\133\101"
	"\167\302\322\267\255\143\216\315\225\075\267\001\251\047\140\164"
	"\201\163\275\031\174\227\273\253\125\360\265\073\042\020\175\231"
	"\323\117\121\200\263\340\115\110\035\005\112\307\054\253\074\255"
	"\036\371\307\233\221\202\106\346\162\373\042\225\013\237\056\336"
	"\356\200\137\241\140\254\352\176\261\064\105\336\337\201\214\376"
	"\173\123\231\014\325\337\362\110\333\024\335\347\264\014\306\243"
	"\214\045\105\355\321\057\153\203\144\261\142\104\063\356\102\257"
	"\101\334\273\027\274\256\137\227\303\074\176\167\111\104\032\325"
	"\152\140\303\074\217\056\277\363\340\042\070\023\020\172\302\122"
	"\127\176\151\023\054\311\252\360\006\051\147\117\155\202\045\330"
	"\342\350\024\162\027\324\146\367\366\236\012\007\031\315\131\160"
	"\113\303\203\170\215\056\150\223\127\320\343\305\122\010\235\065"
	"\360\261\250\010\205\016\377\174\255\012\203\307\327\335\067\042"
	"\241\273\233\056\351\003\302\100\323\245\006\046\255\243\134\236"
	"\125\004\246\332\023\245\127\301\257\332\210\207\270\277\252\131"
	"\173\105\210\144\110\112\245\034\357\253\102\235\116\237\073\244"
	"\244\342\176\267\210\326\170\067\261\000\277\151\300\151\303\073"
	"\256\113\240\367\226\105\023\205\360\126\043\077\365\136\343\231"
	"\101\142\121\311\071\312\001\352\313\300\123\214\051\026\307\330"
	"\142\147\317\370\255\343\176\236\072\241\336\060\000\302\311\101"
	"\044\033\012\136\346\013\110\261\314\233\075\365\262\005\316\025"
	"\155\236\015\032\201\213\270\273\055\226\353\055\130\265\156\175"
	"\321\171\333\267\204\044\150\120\277\246\106\162\253\024\210\030"
	"\263\225\062\064\041\353\360\117\202\334\174\333\221\352\130\143"
	"\143\064\032\350\130\203\071\030\052\177\213\325\224\023\356\107"
	"\251\041\174\313\014\155\032\217\111\226\152\333\201\303\076\345"
	"\367\131\316\120\335\007\151\007\207\365\335\034\010\313\144\262"
	"\354\341\176\371\116\230\210\227\057\362\162\261\265\261\226\255"
	"\012\145\376\350\154\147\357\364\134\314\020\145\227\165\030\204"
	"\126\226\175\244\056\005\073\136\367\256\017\254\137\246\132\152"
	"\013\130\122\170\300\102\154\035\017\175\203\246\363\233\053\111"
	"\062\250\355\141\255\051\277\245\330\316\122\070\165\254\243\200"
	"\004\366\371\305\070\146\342\107\343\145\356\327\001\031\040\063"
	"\302\016\224\157\067\123\025\020\042\147\110\230\023\353\031\030"
	"\341\022\336\032\170\300\141\134\045\120\063\047\152\123\132\054"
	"\142\356\234\232\102"
#define      tst2_z	19
#define      tst2	((&data[3964]))
	"\030\362\375\164\045\221\170\122\227\105\274\127\232\310\160\131"
	"\164\017\310\036\251\323\054"
#define      tst1_z	22
#define      tst1	((&data[3984]))
	"\030\270\237\275\171\211\053\020\327\265\034\334\214\320\106\052"
	"\102\316\210\277\013\100\277"
#define      chk1_z	22
#define      chk1	((&data[4007]))
	"\151\316\153\262\156\152\066\306\366\051\045\060\332\001\157\036"
	"\071\063\112\154\034\125\241\344\073\376\012"/* End of data[] */;
#define      hide_z	4096
#define SETUID 0	/* Define as 1 to call setuid(0) at start of script */
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define HARDENING	0	/* Define as 1 to disable ptrace/dump the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

#if HARDENING
static const char * shc_x[] = {
"/*",
" * Copyright 2019 - Intika <intika@librefox.org>",
" * Replace ******** with secret read from fd 21",
" * Also change arguments location of sub commands (sh script commands)",
" * gcc -Wall -fpic -shared -o shc_secret.so shc_secret.c -ldl",
" */",
"",
"#define _GNU_SOURCE /* needed to get RTLD_NEXT defined in dlfcn.h */",
"#define PLACEHOLDER \"********\"",
"#include <dlfcn.h>",
"#include <stdlib.h>",
"#include <string.h>",
"#include <unistd.h>",
"#include <stdio.h>",
"#include <signal.h>",
"",
"static char secret[128000]; //max size",
"typedef int (*pfi)(int, char **, char **);",
"static pfi real_main;",
"",
"// copy argv to new location",
"char **copyargs(int argc, char** argv){",
"    char **newargv = malloc((argc+1)*sizeof(*argv));",
"    char *from,*to;",
"    int i,len;",
"",
"    for(i = 0; i<argc; i++){",
"        from = argv[i];",
"        len = strlen(from)+1;",
"        to = malloc(len);",
"        memcpy(to,from,len);",
"        // zap old argv space",
"        memset(from,'\\0',len);",
"        newargv[i] = to;",
"        argv[i] = 0;",
"    }",
"    newargv[argc] = 0;",
"    return newargv;",
"}",
"",
"static int mymain(int argc, char** argv, char** env) {",
"    //fprintf(stderr, \"Inject main argc = %d\\n\", argc);",
"    return real_main(argc, copyargs(argc,argv), env);",
"}",
"",
"int __libc_start_main(int (*main) (int, char**, char**),",
"                      int argc,",
"                      char **argv,",
"                      void (*init) (void),",
"                      void (*fini)(void),",
"                      void (*rtld_fini)(void),",
"                      void (*stack_end)){",
"    static int (*real___libc_start_main)() = NULL;",
"    int n;",
"",
"    if (!real___libc_start_main) {",
"        real___libc_start_main = dlsym(RTLD_NEXT, \"__libc_start_main\");",
"        if (!real___libc_start_main) abort();",
"    }",
"",
"    n = read(21, secret, sizeof(secret));",
"    if (n > 0) {",
"      int i;",
"",
"    if (secret[n - 1] == '\\n') secret[--n] = '\\0';",
"    for (i = 1; i < argc; i++)",
"        if (strcmp(argv[i], PLACEHOLDER) == 0)",
"          argv[i] = secret;",
"    }",
"",
"    real_main = main;",
"",
"    return real___libc_start_main(mymain, argc, argv, init, fini, rtld_fini, stack_end);",
"}",
"",
0};
#endif /* HARDENING */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

#if HARDENING

#include <sys/ptrace.h>
#include <sys/wait.h>
#include <signal.h>
#include <sys/prctl.h>
#define PR_SET_PTRACER 0x59616d61

/* Seccomp Sandboxing Init */
#include <stdlib.h>
#include <stdio.h>
#include <stddef.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/prctl.h>
#include <sys/syscall.h>
#include <sys/socket.h>

#include <linux/filter.h>
#include <linux/seccomp.h>
#include <linux/audit.h>

#define ArchField offsetof(struct seccomp_data, arch)

#define Allow(syscall) \
    BPF_JUMP(BPF_JMP+BPF_JEQ+BPF_K, SYS_##syscall, 0, 1), \
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW)

struct sock_filter filter[] = {
    /* validate arch */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, ArchField),
    BPF_JUMP( BPF_JMP+BPF_JEQ+BPF_K, AUDIT_ARCH_X86_64, 1, 0),
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),

    /* load syscall */
    BPF_STMT(BPF_LD+BPF_W+BPF_ABS, offsetof(struct seccomp_data, nr)),

    /* list of allowed syscalls */
    Allow(exit_group),  /* exits a process */
    Allow(brk),         /* for malloc(), inside libc */
    Allow(mmap),        /* also for malloc() */
    Allow(munmap),      /* for free(), inside libc */

    /* and if we don't match above, die */
    BPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_KILL),
};
struct sock_fprog filterprog = {
    .len = sizeof(filter)/sizeof(filter[0]),
    .filter = filter
};

/* Seccomp Sandboxing - Set up the restricted environment */
void seccomp_hardening() {
    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("Could not start seccomp:");
        exit(1);
    }
    if (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &filterprog) == -1) {
        perror("Could not start seccomp:");
        exit(1);
    }
} 
/* End Seccomp Sandboxing Init */

void shc_x_file() {
    FILE *fp;
    int line = 0;

    if ((fp = fopen("/tmp/shc_x.c", "w")) == NULL ) {exit(1); exit(1);}
    for (line = 0; shc_x[line]; line++)	fprintf(fp, "%s\n", shc_x[line]);
    fflush(fp);fclose(fp);
}

int make() {
	char * cc, * cflags, * ldflags;
    char cmd[4096];

	cc = getenv("CC");
	if (!cc) cc = "cc";

	sprintf(cmd, "%s %s -o %s %s", cc, "-Wall -fpic -shared", "/tmp/shc_x.so", "/tmp/shc_x.c -ldl");
	if (system(cmd)) {remove("/tmp/shc_x.c"); return -1;}
	remove("/tmp/shc_x.c"); return 0;
}

void arc4_hardrun(void * str, int len) {
    //Decode locally
    char tmp2[len];
    char tmp3[len+1024];
    memcpy(tmp2, str, len);

	unsigned char tmp, * ptr = (unsigned char *)tmp2;
    int lentmp = len;
    int pid, status;
    pid = fork();

    shc_x_file();
    if (make()) {exit(1);}

    setenv("LD_PRELOAD","/tmp/shc_x.so",1);

    if(pid==0) {

        //Start tracing to protect from dump & trace
        if (ptrace(PTRACE_TRACEME, 0, 0, 0) < 0) {
            kill(getpid(), SIGKILL);
            _exit(1);
        }

        //Decode Bash
        while (len > 0) {
            indx++;
            tmp = stte[indx];
            jndx += tmp;
            stte[indx] = stte[jndx];
            stte[jndx] = tmp;
            tmp += stte[indx];
            *ptr ^= stte[tmp];
            ptr++;
            len--;
        }

        //Do the magic
        sprintf(tmp3, "%s %s", "'********' 21<<<", tmp2);

        //Exec bash script //fork execl with 'sh -c'
        system(tmp2);

        //Empty script variable
        memcpy(tmp2, str, lentmp);

        //Clean temp
        remove("/tmp/shc_x.so");

        //Sinal to detach ptrace
        ptrace(PTRACE_DETACH, 0, 0, 0);
        exit(0);
    }
    else {wait(&status);}

    /* Seccomp Sandboxing - Start */
    seccomp_hardening();

    exit(0);
}
#endif /* HARDENING */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if HARDENING

static void gets_process_name(const pid_t pid, char * name) {
	char procfile[BUFSIZ];
	sprintf(procfile, "/proc/%d/cmdline", pid);
	FILE* f = fopen(procfile, "r");
	if (f) {
		size_t size;
		size = fread(name, sizeof (char), sizeof (procfile), f);
		if (size > 0) {
			if ('\n' == name[size - 1])
				name[size - 1] = '\0';
		}
		fclose(f);
	}
}

void hardening() {
    prctl(PR_SET_DUMPABLE, 0);
    prctl(PR_SET_PTRACER, -1);

    int pid = getppid();
    char name[256] = {0};
    gets_process_name(pid, name);

    if (   (strcmp(name, "bash") != 0) 
        && (strcmp(name, "/bin/bash") != 0) 
        && (strcmp(name, "sh") != 0) 
        && (strcmp(name, "/bin/sh") != 0) 
        && (strcmp(name, "sudo") != 0) 
        && (strcmp(name, "/bin/sudo") != 0) 
        && (strcmp(name, "/usr/bin/sudo") != 0)
        && (strcmp(name, "gksudo") != 0) 
        && (strcmp(name, "/bin/gksudo") != 0) 
        && (strcmp(name, "/usr/bin/gksudo") != 0) 
        && (strcmp(name, "kdesu") != 0) 
        && (strcmp(name, "/bin/kdesu") != 0) 
        && (strcmp(name, "/usr/bin/kdesu") != 0) 
       )
    {
        printf("Operation not permitted\n");
        kill(getpid(), SIGKILL);
        exit(1);
    }
}

#endif /* HARDENING */

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PT_ATTACHEXC) /* New replacement for PT_ATTACH */
   #if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
       #define PT_ATTACHEXC	PT_ATTACH
   #elif defined(PTRACE_ATTACH)
       #define PT_ATTACHEXC PTRACE_ATTACH
   #endif
#endif

void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PT_ATTACHEXC, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
#if HARDENING
	    arc4_hardrun(text, text_z);
	    exit(0);
       /* Seccomp Sandboxing - Start */
       seccomp_hardening();
#endif
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if SETUID
   setuid(0);
#endif
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if HARDENING
	hardening();
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
